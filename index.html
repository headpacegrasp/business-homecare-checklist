<!DOCTYPE ahtml>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comfort Keepers Onboarding Checklist</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind for Inter font and colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        // Custom color palette matching the brand look
                        'primary': '#005f73',
                        'secondary': '#0a9396',
                        'accent': '#94d2bd',
                        'bg-light': '#e9d8a6',
                        'bg-dark': '#ee9b00',
                    }
                }
            }
        }
    </script>
    <!-- Load Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght:100..900&display=swap" rel="stylesheet">
    <style>
        /* Custom scrollbar for checklist container */
        .checklist-container::-webkit-scrollbar {
            width: 8px;
        }
        .checklist-container::-webkit-scrollbar-thumb {
            background-color: #94d2bd;
            border-radius: 4px;
        }
        .checklist-container::-webkit-scrollbar-track {
            background-color: #f0f0f0;
        }
        /* Style for the collapsible summary/details */
        .checklist-item summary {
            display: flex;
            align-items: flex-start;
            padding: 1rem;
            cursor: pointer;
            list-style: none; /* Hide default triangle */
            border-radius: 0.5rem 0.5rem 0 0;
            outline: none;
        }
        .checklist-item[open] summary {
            border-bottom: 1px solid #e5e7eb;
            border-radius: 0.5rem 0.5rem 0 0;
        }
        .checklist-item:not([open]) summary {
             border-radius: 0.5rem;
        }

        /* Custom arrow/indicator for details tag */
        .checklist-item summary::marker {
            display: none;
        }
        .checklist-item summary::before {
            content: "+";
            font-size: 1.5rem;
            line-height: 1.25rem;
            margin-right: 1rem;
            font-weight: bold;
            color: #005f73;
            transition: transform 0.2s;
        }
        .checklist-item[open] summary::before {
            content: "-";
            transform: rotate(0deg);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8 font-sans">

    <div id="app" class="max-w-4xl mx-auto">
        <header class="text-center py-6 mb-8 bg-primary text-white rounded-xl shadow-lg">
            <h1 class="text-3xl font-extrabold tracking-tight">Onboarding Checklist</h1>
            <p class="text-lg opacity-90">Comfort Keepers Franchise - Annapolis, MD</p>
        </header>

        <!-- Progress and Cost Summary Block - Scrolls with the content -->
        <div class="bg-white p-6 rounded-xl shadow-md mb-8 border-t-4 border-secondary">
            
            <!-- Grid Container for Metrics (Progress and Cost) -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <!-- 1. Overall Progress Panel -->
                <div class="border-b md:border-b-0 md:border-r pb-4 md:pb-0 md:pr-6 border-gray-200">
                    <h2 class="text-xl font-semibold text-primary mb-3">Completion Status</h2>
                    <div class="flex items-center space-x-4">
                        <div class="flex-grow bg-gray-200 rounded-full h-4">
                            <div id="progress-bar" class="bg-secondary h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <span id="progress-text" class="text-2xl font-bold text-primary w-20 text-right">0%</span>
                    </div>
                </div>

                <!-- 2. Cost Estimate Tracker Panel -->
                <div class="pt-4 md:pt-0 md:pl-6">
                    <h2 class="text-xl font-semibold text-primary mb-3">Financial Estimate</h2>
                    <div class="flex flex-col space-y-1">
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-600">Total Estimated Budget:</span>
                            <span id="total-estimated-cost" class="font-semibold text-primary">$0</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-600">Cost of Completed Tasks:</span>
                            <span id="completed-cost" class="font-semibold text-bg-dark">$0</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-600">Remaining Budget (Est.):</span>
                            <span id="remaining-budget" class="font-semibold text-green-600">$0</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <p class="text-sm text-gray-500 mt-4 border-t pt-2">All financial metrics are based on estimated **initial setup costs** only, excluding pure recurring monthly operational fees.</p>
        </div>

        <!-- Checklist Container -->
        <div id="checklist-root" class="space-y-6 checklist-container max-h-[70vh] overflow-y-auto pr-2">
            <!-- Checklist items will be injected here -->
            <div class="text-center py-10 text-gray-400">Loading checklist...</div>
        </div>
    </div>

    <script>
        // Key for local storage persistence
        const STORAGE_KEY = 'CK_CHECKLIST_STATE_FULL';

        // --- 1. EMBEDDED CHECKLIST DATA (Includes all details: Summary, Action, Timeline, Cost) ---
        const CHECKLIST_DATA = [
            // --- Pre-Opening Phase (Legal & Business Formation) ---
            { id: 'l1', phase: 'Pre-Opening Phase', title: 'Register Business Entity', summary: 'Establish your business as a legal entity (LLC or Corporation) with the state of Maryland to separate personal and business assets.', action: 'File articles of organization/incorporation with Maryland Department of Assessments & Taxation.', timeline: 'Complete 30-45 days before opening', cost: '$100-300 filing fees' },
            { id: 'l2', phase: 'Pre-Opening Phase', title: 'Obtain Federal EIN', summary: 'The Employer Identification Number (EIN) is required for hiring employees, opening bank accounts, and filing taxes.', action: 'Apply online at IRS.gov or through your accountant.', timeline: 'Complete immediately after entity formation', cost: 'Free' },
            { id: 'l3', phase: 'Pre-Opening Phase', title: 'Apply for Anne Arundel County License', summary: 'Secure necessary county-level operating permits and local business licenses specific to home care services in Annapolis.', action: 'Submit application to Anne Arundel County permitting office.', timeline: 'Complete 25-35 days before opening', cost: '$50-150 local fees' },
            { id: 'l4', phase: 'Pre-Opening Phase', title: 'State Home Care License Application', summary: 'The State of Maryland requires specific licensing for home care agencies to operate legally.', action: 'Submit full license application packet (including facility, staff, and policy details) to the relevant state health department.', timeline: 'Ongoing, up to 90 days for approval', cost: '$500-1,500 application/renewal fees' },
            { id: 'l5', phase: 'Pre-Opening Phase', title: 'Set up HIPAA Compliance', summary: 'Ensure all technology, physical records, and staff training comply with federal HIPAA privacy regulations.', action: 'Develop written HIPAA policies and conduct mandatory training for all staff.', timeline: 'Complete 15 days before opening', cost: '$0 (Internal policy development)' },

            // --- Office Setup & Technology ---
            { id: 'o1', phase: 'Office Setup & Technology', title: 'Secure Office Location', summary: 'Find and lease/purchase a primary office space that is centrally located in Annapolis and suitable for training and administrative functions.', action: 'Finalize lease/purchase agreement and set up utility accounts (electric, gas, water).', timeline: 'Complete 60 days before opening', cost: '$1,500-3,000/month rent' },
            { id: 'o2', phase: 'Office Setup & Technology', title: 'Order Office Equipment & Supplies', summary: 'Purchase essential hardware including desktop computers, a multi-function printer/scanner, and office furniture.', action: 'Order 3-4 workstations, necessary ergonomic seating, and basic supplies (paper, toner, etc.).', timeline: 'Complete 45 days before opening', cost: '$4,000-6,000 capital expenditure' },
            { id: 'o3', phase: 'Office Setup & Technology', title: 'Set up High-Speed Internet & Phone', summary: 'Install reliable business internet and a multi-line phone system for scheduling and client communication.', action: 'Contract with local ISP (e.g., Comcast, Verizon Fios) and set up VoIP phone lines.', timeline: 'Complete 30 days before opening', cost: '$150-300/month recurring' },
            { id: 'o4', phase: 'Office Setup & Technology', title: 'Implement Scheduling Software', summary: 'Select and configure the Comfort Keepers approved client management and scheduling system.', action: 'Enter initial dummy data, configure user roles, and test scheduling workflows.', timeline: 'Complete 20 days before opening', cost: 'Franchise fee includes software access' },
            { id: 'o5', phase: 'Office Setup & Technology', title: 'Establish Backup & Security Protocols', summary: 'Implement secure data backup for client and employee files and install necessary antivirus/firewall protection.', action: 'Set up cloud backup services and password management protocols.', timeline: 'Complete 10 days before opening', cost: '$50-100/month software' },

            // --- Financial & Insurance ---
            { id: 'f1', phase: 'Financial & Insurance', title: 'Open Business Bank Accounts', summary: 'Establish separate checking, savings, and potentially payroll accounts with a local Annapolis bank or credit union.', action: 'Present EIN and Articles of Organization to bank for account setup.', timeline: 'Complete 40 days before opening', cost: '$0 (Minimum balances may apply)' },
            { id: 'f2', phase: 'Financial & Insurance', title: 'Secure General Liability Insurance', summary: 'Protects the business against third-party claims of property damage or bodily injury.', action: 'Contact specialized insurance broker to obtain competitive quotes and binding coverage.', timeline: 'Complete 30 days before opening', cost: '$700-1,500/year premium' },
            { id: 'f3', phase: 'Financial & Insurance', title: 'Obtain Professional Liability (Errors & Omissions)', summary: 'Covers claims of negligence or errors in professional services provided (essential for home care).', action: 'Add Professional Liability rider to existing insurance policy or acquire separately.', timeline: 'Complete 30 days before opening', cost: '$500-1,000/year premium' },
            { id: 'f4', phase: 'Financial & Insurance', title: 'Establish Workers\' Compensation Insurance', summary: 'Required by Maryland law to cover employees who suffer job-related injuries.', action: 'Enroll in a Maryland-compliant Workers\' Comp program based on estimated payroll.', timeline: 'Complete before first employee is hired', cost: 'Varies based on payroll' },
            { id: 'f5', phase: 'Financial & Insurance', title: 'Set up Payroll System', summary: 'Select and configure a reliable payroll service to manage employee wages, taxes, and reporting (e.g., ADP, Paychex, Gusto).', action: 'Integrate payroll system with bank accounts and tax ID numbers.', timeline: 'Complete 20 days before opening', cost: '$50-100/month + per-employee fee' },

            // --- Staffing & HR ---
            { id: 'h1', phase: 'Staffing & HR', title: 'Finalize Job Descriptions', summary: 'Create clear, detailed job descriptions for all key roles: Caregiver/CNA, Scheduler, and Office Manager.', action: 'Review template JDs provided by Comfort Keepers corporate and customize for local Annapolis market.', timeline: 'Complete 50 days before opening', cost: '$0' },
            { id: 'h2', phase: 'Staffing & HR', title: 'Launch Caregiver Recruitment Campaign', summary: 'Begin aggressive advertising to build a strong pipeline of qualified caregivers, often requiring 15-20 hires before opening.', action: 'Post ads on Indeed, Craigslist, local nursing school job boards, and Facebook.', timeline: 'Start 60 days before opening', cost: '$500-1,000/month advertising' },
            { id: 'h3', phase: 'Staffing & HR', title: 'Implement Applicant Tracking System (ATS)', summary: 'Use the corporate ATS or a dedicated system to manage the high volume of applications efficiently.', action: 'Configure ATS to automatically screen for Maryland certification requirements.', timeline: 'Start 60 days before opening', cost: 'Included in franchise tech stack' },
            { id: 'h4', phase: 'Staffing & HR', title: 'Begin Interviewing Key Staff', summary: 'Identify and hire the Office Manager/Scheduler, as they will assist with final caregiver hiring.', action: 'Conduct face-to-face or video interviews for 3-5 top candidates for management roles.', timeline: 'Complete 30 days before opening', cost: '$0' },
            { id: 'h5', phase: 'Staffing & HR', title: 'Complete Background Checks & Vetting', summary: 'Mandatory state and federal background checks, reference checks, and drug screening for all potential hires.', action: 'Select a third-party screening provider and establish consistent pass/fail criteria.', timeline: 'Ongoing, as applications arrive', cost: '$50-100 per check' },

            // --- Training & Certification ---
            { id: 't1', phase: 'Training & Certification', title: 'Complete Franchisee Training', summary: 'The owner must complete all mandatory corporate training modules on operations, sales, and care standards.', action: 'Schedule and attend the required corporate training sessions (in-person or online).', timeline: 'Complete 45 days before opening', cost: 'Included in Franchise Fee' },
            { id: 't2', phase: 'Training & Certification', title: 'Staff Orientation & Onboarding', summary: 'Conduct initial orientation for newly hired administrative staff (Office Manager, Scheduler).', action: 'Cover topics like company mission, software use, and Annapolis service area details.', timeline: 'Complete 15 days before opening', cost: '$0' },
            { id: 't3', phase: 'Training & Certification', title: 'Caregiver Skills Training', summary: 'Implement the Comfort Keepers standardized training program for all caregivers, including specialized skills like dementia care.', action: 'Run the first two full-day training sessions for the initial cohort of 10-15 caregivers.', timeline: 'Complete 5 days before opening', cost: 'Staff time (approx. 16 hours/caregiver)' },
            { id: 't4', phase: 'Training & Certification', title: 'CPR/First Aid Certification Verification', summary: 'Ensure all professional staff maintain current CPR and First Aid certifications as required by state guidelines.', action: 'Collect and file copies of current certifications for all caregivers and field staff.', timeline: 'Ongoing documentation', cost: '$0' },
            { id: 't5', phase: 'Training & Certification', title: 'Emergency Protocol Drills', summary: 'Run scenarios covering medical emergencies, natural disasters, and unexpected call-offs.', action: 'Document a clear emergency communication and response plan for the office and field staff.', timeline: 'Complete 5 days before opening', cost: '$0' },

            // --- Marketing & Sales Readiness ---
            { id: 'm1', phase: 'Marketing & Sales Readiness', title: 'Design Local Marketing Materials', summary: 'Create printed materials customized with the Annapolis address and phone number: brochures, business cards, and branded folders.', action: 'Order initial print run of 500 brochures and 1,000 business cards.', timeline: 'Complete 30 days before opening', cost: '$800-1,500 printing costs' },
            { id: 'm2', phase: 'Marketing & Sales Readiness', title: 'Launch Digital Presence', summary: 'Verify and optimize essential online profiles where clients and referrers search for local care.', action: 'Claim and optimize Google Business Profile, set up Yelp, and create professional social media pages (Facebook/LinkedIn).', timeline: 'Complete 25 days before opening', cost: '$0 (Staff time)' },
            { id: 'm3', phase: 'Marketing & Sales Readiness', title: 'Begin Community Networking (Hospitals)', summary: 'Start building relationships with discharge planners and social workers at major Annapolis hospitals (e.g., Anne Arundel Medical Center).', action: 'Schedule introductory meetings with key referral sources, leaving marketing materials.', timeline: 'Start 45 days before opening', cost: '$100-300 travel/coffee' },
            { id: 'm4', phase: 'Marketing & Sales Readiness', title: 'Networking (Assisted Living/SNFs)', summary: 'Introduce the Comfort Keepers service to local assisted living facilities and skilled nursing facilities (SNFs).', action: 'Visit 10-15 local facilities to understand their needs and introduce your services.', timeline: 'Start 40 days before opening', cost: '$100-300 travel' },
            { id: 'm5', phase: 'Marketing & Sales Readiness', title: 'Client Intake Process Simulation', summary: 'Practice the full sales cycle from initial inquiry call to in-home assessment and signing of the service agreement.', action: 'Role-play 5 different client scenarios with the Office Manager/Scheduler.', timeline: 'Complete 7 days before opening', cost: '$0' },

            // --- Client Service Readiness & GO-LIVE ---
            { id: 's1', phase: 'Client Service Readiness & GO-LIVE', title: 'Finalize Care Planning Software Setup', summary: 'Ensure the client management system is fully ready to handle real-time scheduling, clock-in/out, and billing.', action: 'Run final system test using a mock client profile and caregiver assignment.', timeline: 'Complete 5 days before opening', cost: '$0' },
            { id: 's2', phase: 'Client Service Readiness & GO-LIVE', title: 'Develop Standard Operating Procedures (SOPs)', summary: 'Document detailed SOPs for client intake, scheduling changes, handling complaints, and employee time-off requests.', action: 'Print and bind SOP manuals for all office staff to reference.', timeline: 'Complete 10 days before opening', cost: '$0' },
            { id: 's3', phase: 'Client Service Readiness & GO-LIVE', title: 'GO-LIVE: Accept First Client Intake Call', summary: 'The official start of accepting new client inquiries and beginning the in-home assessment process.', action: 'Designate the lead intake person and track the first 5 inquiries diligently.', timeline: 'Start on official launch date (Jan 31, 2026)', cost: '$0' },
            { id: 's4', phase: 'Client Service Readiness & GO-LIVE', title: 'First Caregiver Shift Successfully Completed', summary: 'The first shift of service marks the full transition from planning to operations.', action: 'Follow up with the caregiver and the client within 2 hours of shift completion for feedback.', timeline: 'Within 7 days of GO-LIVE', cost: '$0' },
            { id: 's5', phase: 'Client Service Readiness & GO-LIVE', title: 'Host Official Ribbon Cutting Event', summary: 'Announce your grand opening to the local community, media, and key referral sources.', action: 'Partner with the Annapolis Chamber of Commerce and invite local officials/press.', timeline: 'Within 30 days of GO-LIVE', cost: '$500-1,500 event costs' },
            
            // Adding more items to ensure a sufficient list size and detail density
            // --- Financial & Compliance Deep Dive ---
            { id: 'f6', phase: 'Financial & Insurance', title: 'Setup Billing & Invoicing System', summary: 'Configure the system to generate invoices for private pay clients and electronic claims for insurance/long-term care policies.', action: 'Integrate billing module with accounting software (e.g., QuickBooks).', timeline: 'Complete 25 days before opening', cost: '$20-50/month accounting software' },
            { id: 'f7', phase: 'Financial & Insurance', title: 'Tax Authority Registration', summary: 'Register the business with the Maryland Comptroller for state tax purposes (income tax withholding, sales tax if applicable).', action: 'File required registration forms online with the state tax authority.', timeline: 'Complete 30 days before opening', cost: '$0' },
            // --- Office & Tech Deep Dive ---
            { id: 'o6', phase: 'Office Setup & Technology', title: 'Install Alarm & Access Control', summary: 'Secure the office space with a monitored alarm system and keycard/code access for employees.', action: 'Contract local security company for installation and monitoring.', timeline: 'Complete 20 days before opening', cost: '$500 installation, $50/month monitoring' },
            { id: 'o7', phase: 'Office Setup & Technology', title: 'Finalize Website Local Content', summary: 'Ensure the corporate website accurately reflects the Annapolis location, service area, and contact details.', action: 'Upload photos of the local office and customize local testimonials/news.', timeline: 'Complete 15 days before opening', cost: '$0 (Franchise team support)' },
            // --- Staffing & HR Deep Dive ---
            { id: 'h6', phase: 'Staffing & HR', title: 'Develop Employee Handbook', summary: 'A comprehensive handbook covering HR policies, conduct, benefits, and local Maryland employment laws.', action: 'Customize the corporate handbook template with Annapolis-specific contacts and local labor laws.', timeline: 'Complete 35 days before opening', cost: '$0 (Legal review recommended)' },
            { id: 'h7', phase: 'Staffing & HR', title: 'Implement Retention Strategy', summary: 'Plan out initiatives to keep caregivers engaged and reduce turnover (e.g., bonuses, recognition programs).', action: 'Establish a monthly caregiver recognition award and review structure.', timeline: 'Complete 20 days before opening', cost: '$100/month for awards' },
            // --- Marketing & Sales Deep Dive ---
            { id: 'm6', phase: 'Marketing & Sales Readiness', title: 'Develop Referral Tracking System', summary: 'Establish a reliable method to track the source and performance of all client referrals.', action: 'Configure the scheduling software to accurately log referral sources for reporting.', timeline: 'Complete 10 days before opening', cost: '$0' },
            { id: 'm7', phase: 'Marketing & Sales Readiness', title: 'Launch Targeted Facebook Campaign', summary: 'Run a geographically targeted ad campaign to Annapolis residents focusing on specific services (e.g., Dementia Care).', action: 'Create 3 separate ad creatives and allocate initial budget.', timeline: 'Start 15 days before opening', cost: '$500 initial ad spend' },
            // --- Training & Compliance Deep Dive ---
            { id: 't6', phase: 'Training & Certification', title: 'Mandatory Abuse/Neglect Reporting Training', summary: 'Train all staff on the legal requirements and procedures for reporting suspected abuse or neglect in Maryland.', action: 'Document signed acknowledgments from all employees confirming they received this training.', timeline: 'During initial staff training', cost: '$0' },
            { id: 't7', phase: 'Training & Certification', title: 'Competency Check-offs for Caregivers', summary: 'Verify that each caregiver can successfully demonstrate core competencies (e.g., safe transfer, vital signs).', action: 'The RN or qualified trainer performs mandatory check-offs before assigning first shift.', timeline: '5 days before opening', cost: '$0' },
        ];


        // Global variable to hold the checked state of all items
        let checklistState = {};

        // --- 2. LOCAL PERSISTENCE FUNCTIONS ---

        /**
         * Loads the checklist state from localStorage or initializes it.
         */
        function loadState() {
            try {
                const storedState = localStorage.getItem(STORAGE_KEY);
                if (storedState) {
                    const parsedState = JSON.parse(storedState);
                    CHECKLIST_DATA.forEach(item => {
                        // Use stored value if available, otherwise default to false
                        checklistState[item.id] = parsedState.hasOwnProperty(item.id) ? parsedState[item.id] : false;
                    });
                } else {
                    // Initialize all items to unchecked
                    CHECKLIST_DATA.forEach(item => {
                        checklistState[item.id] = false;
                    });
                }
            } catch (error) {
                console.error("Error loading state from localStorage:", error);
                CHECKLIST_DATA.forEach(item => { checklistState[item.id] = false; });
            }
        }

        /**
         * Saves the current checklist state to localStorage.
         */
        function saveState() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(checklistState));
            } catch (error) {
                console.error("Error saving state to localStorage:", error);
            }
        }

        // --- 3. CORE LOGIC FUNCTIONS ---
        
        /**
         * Parses a cost string (e.g., "$100-300 filing fees") into a single numeric value for budgeting.
         * Returns 0 for "Free", "Varies", or pure recurring monthly/yearly costs.
         */
        function parseCost(costString) {
            if (!costString) return 0;
            const lowerCost = costString.toLowerCase();

            // Exclude non-numeric/variable costs from the total estimated SETUP budget
            if (lowerCost.includes('free') || lowerCost.includes('varies') || lowerCost.includes('staff time') || lowerCost.includes('included') || lowerCost.includes('/month recurring') || lowerCost.includes('/year premium')) {
                return 0;
            }
            
            // Remove currency symbols, commas, and trailing non-numeric characters for simple processing
            // The logic here is simplified to catch major numbers/ranges while excluding pure recurring fees
            
            // Handle ranges (e.g., "100-300")
            if (costString.includes('-')) {
                const parts = costString.match(/\$([\d,]+)-([\d,]+)/);
                if (parts) {
                    const val1 = parseFloat(parts[1].replace(/,/g, ''));
                    const val2 = parseFloat(parts[2].replace(/,/g, ''));
                    return (val1 + val2) / 2; // Average of the range
                }
            }
            
            // Handle single numbers (e.g., "$500 installation" or "$4,000 capital")
            const singleMatch = costString.match(/\$([\d,]+)/);
            if (singleMatch) {
                return parseFloat(singleMatch[1].replace(/,/g, ''));
            }

            return 0;
        }

        /**
         * Calculates and updates both the progress bar and the financial metrics.
         */
        function updateMetrics() {
            // --- PROGRESS CALCULATION ---
            const totalItems = CHECKLIST_DATA.length;
            const completedItems = CHECKLIST_DATA.filter(item => checklistState[item.id]).length;
            const percentage = totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;

            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');

            progressBar.style.width = `${percentage}%`;
            progressText.textContent = `${percentage}%`;

            if (percentage === 100) {
                progressBar.classList.add('bg-bg-dark');
                progressBar.classList.remove('bg-secondary');
            } else {
                progressBar.classList.remove('bg-bg-dark');
                progressBar.classList.add('bg-secondary');
            }

            // --- COST CALCULATION ---
            let totalEstimatedCost = 0;
            let costOfCompletedItems = 0;

            CHECKLIST_DATA.forEach(item => {
                const itemCost = parseCost(item.cost);
                totalEstimatedCost += itemCost;
                
                if (checklistState[item.id]) {
                    costOfCompletedItems += itemCost;
                }
            });

            const remainingBudget = totalEstimatedCost - costOfCompletedItems;

            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(amount);
            };

            document.getElementById('total-estimated-cost').textContent = formatCurrency(totalEstimatedCost);
            document.getElementById('completed-cost').textContent = formatCurrency(costOfCompletedItems);
            
            const remainingBudgetElement = document.getElementById('remaining-budget');
            remainingBudgetElement.textContent = formatCurrency(remainingBudget);
            
            // Highlight the remaining budget based on status
            remainingBudgetElement.classList.remove('text-green-600', 'text-red-600');
            if (remainingBudget >= 0) {
                remainingBudgetElement.classList.add('text-green-600');
            } else {
                remainingBudgetElement.classList.add('text-red-600');
            }
        }

        /**
         * Handles the change event for a checklist item.
         */
        function handleCheck(itemId, isChecked, itemElement) {
            checklistState[itemId] = isChecked;
            saveState();
            updateMetrics(); // Changed to call updateMetrics()
            
            // Find the summary element (the visible part)
            const summary = itemElement.querySelector('summary');
            const titleSpan = itemElement.querySelector('.item-title');
            
            // Update item appearance based on check state
            if (isChecked) {
                titleSpan.classList.add('line-through', 'text-gray-600');
                titleSpan.classList.remove('text-primary');
                itemElement.classList.add('bg-accent/20', 'border-accent');
                itemElement.classList.remove('bg-white', 'hover:bg-gray-50', 'shadow-sm');
                // Ensure the summary background updates correctly
                summary.classList.add('bg-accent/30');
                summary.classList.remove('bg-white');
            } else {
                titleSpan.classList.remove('line-through', 'text-gray-600');
                titleSpan.classList.add('text-primary');
                itemElement.classList.remove('bg-accent/20', 'border-accent');
                itemElement.classList.add('bg-white', 'hover:bg-gray-50', 'shadow-sm');
                 // Ensure the summary background updates correctly
                summary.classList.remove('bg-accent/30');
                summary.classList.add('bg-white');
            }
        }

        // --- 4. RENDERING FUNCTIONS ---

        /**
         * Renders the entire checklist to the DOM.
         */
        function renderChecklist() {
            loadState();
            const root = document.getElementById('checklist-root');
            root.innerHTML = ''; 

            // Group items by phase
            const phases = CHECKLIST_DATA.reduce((acc, item) => {
                if (!acc[item.phase]) {
                    acc[item.phase] = [];
                }
                acc[item.phase].push(item);
                return acc;
            }, {});

            for (const phase in phases) {
                // Phase Header - Removed sticky classes
                const phaseHeader = document.createElement('h2');
                phaseHeader.className = 'text-2xl font-extrabold text-primary pt-4 pb-2 border-b-2 border-accent mb-4 bg-gray-50';
                phaseHeader.textContent = phase;
                root.appendChild(phaseHeader);

                // Render Phase Items
                phases[phase].forEach(item => {
                    const isChecked = checklistState[item.id] || false;
                    
                    // Use <details> for the collapsible item container
                    const itemElement = document.createElement('details');
                    itemElement.id = `detail-item-${item.id}`;
                    itemElement.className = `checklist-item border border-gray-200 rounded-lg shadow-sm transition-all duration-200 ${isChecked ? 'bg-accent/20 border-accent' : 'bg-white hover:bg-gray-50'}`;
                    
                    // The Summary (always visible part: Checkbox, Title, Summary)
                    const summary = document.createElement('summary');
                    summary.className = `flex items-start space-x-4 transition-all duration-200 ${isChecked ? 'bg-accent/30' : 'bg-white hover:bg-gray-50'}`;
                    
                    summary.innerHTML = `
                        <!-- Placeholder for the custom CSS indicator -->
                        <div class="flex-shrink-0 pt-1 w-6"></div> 
                        <div class="flex-grow flex items-start space-x-4">
                            <input type="checkbox" id="item-${item.id}"
                                   class="mt-1 w-5 h-5 text-secondary border-gray-300 rounded focus:ring-secondary/50 checked:bg-secondary checked:border-secondary transition-colors duration-150 cursor-pointer"
                                   ${isChecked ? 'checked' : ''}>
                            <label for="item-${item.id}" class="flex flex-col flex-grow cursor-pointer -mt-1">
                                <span class="text-lg font-semibold item-title ${isChecked ? 'line-through text-gray-600' : 'text-primary'}">
                                    ${item.title}
                                </span>
                                <span class="text-sm text-gray-500 mt-0.5">${item.summary}</span>
                            </label>
                        </div>
                    `;

                    // The Detail Content (Collapsible part: Action, Timeline, Cost)
                    const detailContent = document.createElement('div');
                    detailContent.className = 'p-4 pt-0 text-sm bg-white rounded-b-lg border-t border-gray-200';
                    
                    // Helper function to render a detail row
                    const renderDetailRow = (label, value, colorClass) => `
                        <div class="flex mb-2">
                            <span class="font-bold w-24 text-${colorClass}">${label}:</span>
                            <span class="flex-1 text-gray-700">${value}</span>
                        </div>
                    `;

                    detailContent.innerHTML = `
                        <h4 class="font-bold text-lg text-secondary mb-3 mt-2">Detailed Plan</h4>
                        ${renderDetailRow('Action', item.action, 'primary')}
                        ${renderDetailRow('Timeline', item.timeline, 'secondary')}
                        ${renderDetailRow('Cost', item.cost, 'bg-dark')}
                    `;
                    
                    itemElement.appendChild(summary);
                    itemElement.appendChild(detailContent);
                    root.appendChild(itemElement);

                    // Attach event listener to the checkbox inside the summary
                    const checkbox = summary.querySelector(`#item-${item.id}`);
                    checkbox.addEventListener('change', (e) => {
                        // Pass the details element itself to update its appearance
                        handleCheck(item.id, e.target.checked, itemElement);
                    });
                });
            }

            // Initial calculation after rendering
            updateMetrics(); // Changed to call updateMetrics()
        }

        // --- 5. INITIALIZATION ---

        /**
         * Main function to run on page load.
         */
        window.onload = function() {
            console.log("Checklist initialized with full detail. Using localStorage for persistence.");
            renderChecklist();
        };

    </script>

</body>
</html>
